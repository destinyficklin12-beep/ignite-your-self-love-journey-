<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module Quiz - Self Love Course</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .quiz-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .quiz-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .quiz-header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .quiz-header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        .back-button:hover {
            background: rgba(255,255,255,0.3);
        }

        .quiz-content {
            padding: 40px;
        }

        .module-selector {
            margin-bottom: 30px;
        }

        .module-selector h2 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .module-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
        }

        .module-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .module-btn.completed::after {
            content: '‚úÖ';
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 20px;
        }

        .quiz-section {
            display: none;
        }

        .quiz-section.active {
            display: block;
        }

        .question-container {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .question-number {
            color: #667eea;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 18px;
            color: #333;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            background: white;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
        }

        .option:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .option input[type="radio"] {
            margin-right: 12px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .option label {
            cursor: pointer;
            flex: 1;
            font-size: 16px;
        }

        .quiz-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #666;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .results-section {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .results-section.active {
            display: block;
        }

        .score-display {
            font-size: 72px;
            font-weight: bold;
            color: #667eea;
            margin: 20px 0;
        }

        .score-message {
            font-size: 24px;
            color: #333;
            margin-bottom: 30px;
        }

        .pass {
            color: #4caf50;
        }

        .fail {
            color: #f44336;
        }

        .feedback {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: left;
        }

        .feedback-item {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
        }

        .feedback-item.correct {
            border-left: 4px solid #4caf50;
        }

        .feedback-item.incorrect {
            border-left: 4px solid #f44336;
        }

        @media (max-width: 600px) {
            .quiz-content {
                padding: 20px;
            }

            .module-grid {
                grid-template-columns: 1fr;
            }

            .quiz-header h1 {
                font-size: 22px;
            }

            .back-button {
                position: static;
                margin-bottom: 20px;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="quiz-container">
        <div class="quiz-header">
            <button class="back-button" onclick="window.location.href='course.html'">‚Üê Back to Course</button>
            <h1>üìù Module Quizzes</h1>
            <p>Test your knowledge and track your progress</p>
        </div>

        <div class="quiz-content">
            <!-- Module Selector -->
            <div class="module-selector" id="module-selector">
                <h2>Select a Module to Quiz</h2>
                <div class="module-grid" id="module-grid">
                    <!-- Module buttons will be loaded here -->
                </div>
            </div>

            <!-- Quiz Section -->
            <div class="quiz-section" id="quiz-section">
                <div id="questions-container"></div>
                <div class="quiz-actions">
                    <button class="btn btn-secondary" onclick="backToModules()">Cancel</button>
                    <button class="btn btn-primary" onclick="submitQuiz()">Submit Quiz</button>
                </div>
            </div>

            <!-- Results Section -->
            <div class="results-section" id="results-section">
                <h2>Quiz Complete! üéâ</h2>
                <div class="score-display" id="score-display">0%</div>
                <div class="score-message" id="score-message"></div>
                <div class="feedback" id="feedback-container"></div>
                <div class="quiz-actions">
                    <button class="btn btn-secondary" onclick="backToModules()">Back to Modules</button>
                    <button class="btn btn-primary" onclick="retakeQuiz()">Retake Quiz</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCqHAkHHFpyRc4egDn3aafZcvfR0qhVTAw",
            authDomain: "self-love-course.firebaseapp.com",
            projectId: "self-love-course",
            storageBucket: "self-love-course.firebasestorage.app",
            messagingSenderId: "115196735828",
            appId: "1:115196735828:web:426f660bd8b034fd89d8c1",
            measurementId: "G-WTPVKYL5X0"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = null;
        let completedQuizzes = [];
        let currentModule = null;
        let userAnswers = {};

        // Quiz Questions for Each Module
        const quizData = {
            1: {
                title: "Understanding Self-Love",
                questions: [
                    {
                        question: "What is the foundation of self-love?",
                        options: ["Self-acceptance", "Self-criticism", "Comparing to others", "Seeking validation"],
                        correct: 0
                    },
                    {
                        question: "Self-love means:",
                        options: ["Being selfish", "Prioritizing others always", "Caring for your wellbeing", "Never saying no"],
                        correct: 2
                    },
                    {
                        question: "Which practice supports self-love?",
                        options: ["Negative self-talk", "Setting boundaries", "Ignoring your needs", "Perfectionism"],
                        correct: 1
                    },
                    {
                        question: "Self-love is important because:",
                        options: ["It makes you better than others", "It helps you care for others better", "It's selfish but necessary", "It replaces relationships"],
                        correct: 1
                    },
                    {
                        question: "A key aspect of self-love is:",
                        options: ["Never making mistakes", "Accepting your imperfections", "Always being happy", "Pleasing everyone"],
                        correct: 1
                    }
                ]
            },
            2: {
                title: "Self-Awareness & Acceptance",
                questions: [
                    {
                        question: "Self-awareness involves:",
                        options: ["Judging yourself harshly", "Understanding your patterns", "Comparing to others", "Hiding your flaws"],
                        correct: 1
                    },
                    {
                        question: "Acceptance means:",
                        options: ["Giving up on growth", "Acknowledging reality without judgment", "Settling for less", "Never changing"],
                        correct: 1
                    },
                    {
                        question: "How can you increase self-awareness?",
                        options: ["Avoiding reflection", "Journaling and meditation", "Staying busy constantly", "Ignoring emotions"],
                        correct: 1
                    },
                    {
                        question: "Self-acceptance helps you:",
                        options: ["Feel stuck", "Embrace your authentic self", "Avoid challenges", "Stay in your comfort zone"],
                        correct: 1
                    },
                    {
                        question: "What supports self-awareness?",
                        options: ["Mindfulness practices", "Constant distraction", "Numbing emotions", "Avoiding silence"],
                        correct: 0
                    }
                ]
            },
            3: {
                title: "Inner Child Healing",
                questions: [
                    {
                        question: "Your inner child represents:",
                        options: ["Childish behavior", "Past wounds and needs", "Immaturity", "Regression"],
                        correct: 1
                    },
                    {
                        question: "Inner child healing involves:",
                        options: ["Ignoring the past", "Reparenting yourself", "Blaming others", "Staying stuck"],
                        correct: 1
                    },
                    {
                        question: "How can you connect with your inner child?",
                        options: ["Acting immature", "Guided visualization", "Ignoring feelings", "Numbing pain"],
                        correct: 1
                    },
                    {
                        question: "Healing your inner child helps:",
                        options: ["Release old patterns", "Stay in the past", "Avoid growth", "Blame parents forever"],
                        correct: 0
                    },
                    {
                        question: "A sign of inner child wounds:",
                        options: ["Healthy boundaries", "People-pleasing patterns", "Self-confidence", "Emotional regulation"],
                        correct: 1
                    }
                ]
            },
            4: {
                title: "Positive Self-Talk",
                questions: [
                    {
                        question: "Positive self-talk is:",
                        options: ["Lying to yourself", "Encouraging inner dialogue", "Ignoring problems", "Toxic positivity"],
                        correct: 1
                    },
                    {
                        question: "How to change negative self-talk?",
                        options: ["Ignore it", "Challenge and reframe it", "Suppress it", "Believe it fully"],
                        correct: 1
                    },
                    {
                        question: "Self-talk affects:",
                        options: ["Nothing important", "Your thoughts, feelings, and actions", "Only your mood", "Just your words"],
                        correct: 1
                    },
                    {
                        question: "A helpful self-talk technique:",
                        options: ["Self-criticism", "Speaking to yourself like a friend", "Harsh judgment", "Perfectionism"],
                        correct: 1
                    },
                    {
                        question: "When you catch negative self-talk:",
                        options: ["Feel guilty", "Pause and reframe", "Ignore it", "Believe it"],
                        correct: 1
                    }
                ]
            },
            5: {
                title: "Setting Boundaries",
                questions: [
                    {
                        question: "Boundaries are:",
                        options: ["Walls to keep people out", "Healthy limits that protect you", "Selfish barriers", "Signs of weakness"],
                        correct: 1
                    },
                    {
                        question: "Setting boundaries means:",
                        options: ["Being mean", "Honoring your needs", "Isolating yourself", "Never helping others"],
                        correct: 1
                    },
                    {
                        question: "Why are boundaries important?",
                        options: ["To control others", "To protect your energy and wellbeing", "To be difficult", "To avoid relationships"],
                        correct: 1
                    },
                    {
                        question: "How to communicate boundaries?",
                        options: ["Aggressively", "Clearly and kindly", "Passive-aggressively", "By hints only"],
                        correct: 1
                    },
                    {
                        question: "Healthy boundaries include:",
                        options: ["Saying yes to everything", "Saying no when needed", "Never disappointing anyone", "Ignoring your limits"],
                        correct: 1
                    }
                ]
            },
            6: {
                title: "Self-Care Rituals",
                questions: [
                    {
                        question: "Self-care is:",
                        options: ["Selfish indulgence", "Necessary for wellbeing", "Only for the wealthy", "A luxury"],
                        correct: 1
                    },
                    {
                        question: "Effective self-care includes:",
                        options: ["Only spa days", "Regular sustainable practices", "Expensive products", "Occasional treats only"],
                        correct: 1
                    },
                    {
                        question: "Daily self-care can be:",
                        options: ["Time-consuming only", "Simple and brief", "Impossible to maintain", "Only for weekends"],
                        correct: 1
                    },
                    {
                        question: "Self-care helps you:",
                        options: ["Avoid responsibilities", "Recharge and show up better", "Be lazy", "Escape life"],
                        correct: 1
                    },
                    {
                        question: "Types of self-care include:",
                        options: ["Only physical", "Physical, mental, emotional, spiritual", "Just relaxation", "Only exercise"],
                        correct: 1
                    }
                ]
            },
            7: {
                title: "Self-Compassion",
                questions: [
                    {
                        question: "Self-compassion means:",
                        options: ["Making excuses", "Treating yourself with kindness", "Lowering standards", "Giving up"],
                        correct: 1
                    },
                    {
                        question: "When you make a mistake, self-compassion involves:",
                        options: ["Harsh criticism", "Understanding and forgiveness", "Denial", "Self-punishment"],
                        correct: 1
                    },
                    {
                        question: "Self-compassion is:",
                        options: ["Weakness", "A strength", "Self-pity", "Laziness"],
                        correct: 1
                    },
                    {
                        question: "How to practice self-compassion?",
                        options: ["Be your own worst critic", "Speak to yourself like a good friend", "Never acknowledge mistakes", "Compare to others"],
                        correct: 1
                    },
                    {
                        question: "Self-compassion helps with:",
                        options: ["Avoiding growth", "Resilience and healing", "Staying stuck", "Self-indulgence"],
                        correct: 1
                    }
                ]
            },
            8: {
                title: "Authentic Living",
                questions: [
                    {
                        question: "Authentic living means:",
                        options: ["Pleasing everyone", "Being true to yourself", "Never changing", "Following trends"],
                        correct: 1
                    },
                    {
                        question: "Living authentically requires:",
                        options: ["Perfection", "Courage and self-awareness", "Approval from others", "Conformity"],
                        correct: 1
                    },
                    {
                        question: "A sign of authentic living:",
                        options: ["Constant people-pleasing", "Honoring your values", "Hiding your true self", "Following others' paths"],
                        correct: 1
                    },
                    {
                        question: "Authentic living helps you:",
                        options: ["Fit in better", "Feel aligned and fulfilled", "Avoid judgment", "Please everyone"],
                        correct: 1
                    },
                    {
                        question: "To live authentically:",
                        options: ["Hide your quirks", "Embrace your uniqueness", "Copy others", "Seek constant validation"],
                        correct: 1
                    }
                ]
            }
        };

        // Check authentication
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                await loadQuizProgress();
                renderModuleButtons();
            } else {
                window.location.href = 'auth.html';
            }
        });

        // Load quiz progress
        async function loadQuizProgress() {
            try {
                const progressDoc = await db.collection('users')
                    .doc(currentUser.uid)
                    .collection('progress')
                    .doc('quizzes')
                    .get();

                if (progressDoc.exists) {
                    completedQuizzes = progressDoc.data().completed || [];
                }
            } catch (error) {
                console.error('Error loading quiz progress:', error);
            }
        }

        // Render module buttons
        function renderModuleButtons() {
            const grid = document.getElementById('module-grid');
            grid.innerHTML = '';

            for (let i = 1; i <= 8; i++) {
                const button = document.createElement('button');
                button.className = `module-btn ${completedQuizzes.includes(i) ? 'completed' : ''}`;
                button.textContent = `Module ${i}`;
                button.onclick = () => startQuiz(i);
                grid.appendChild(button);
            }
        }

        // Start quiz
        function startQuiz(moduleNumber) {
            currentModule = moduleNumber;
            userAnswers = {};
            
            document.getElementById('module-selector').style.display = 'none';
            document.getElementById('quiz-section').classList.add('active');
            
            renderQuestions();
        }

        // Render questions
        function renderQuestions() {
            const container = document.getElementById('questions-container');
            const quiz = quizData[currentModule];
            
            container.innerHTML = `<h2 style="text-align: center; color: #667eea; margin-bottom: 30px;">${quiz.title}</h2>`;
            
            quiz.questions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-container';
                
                questionDiv.innerHTML = `
                    <div class="question-number">Question ${index + 1} of ${quiz.questions.length}</div>
                    <div class="question-text">${q.question}</div>
                    <div class="options">
                        ${q.options.map((option, optIndex) => `
                            <div class="option">
                                <input type="radio" 
                                       id="q${index}_opt${optIndex}" 
                                       name="question${index}" 
                                       value="${optIndex}"
                                       onchange="saveAnswer(${index}, ${optIndex})">
                                <label for="q${index}_opt${optIndex}">${option}</label>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                container.appendChild(questionDiv);
            });
        }

        // Save answer
        window.saveAnswer = function(questionIndex, optionIndex) {
            userAnswers[questionIndex] = optionIndex;
        };

        // Submit quiz
        window.submitQuiz = function() {
            const quiz = quizData[currentModule];
            
            if (Object.keys(userAnswers).length < quiz.questions.length) {
                alert('Please answer all questions before submitting!');
                return;
            }
            
            let correct = 0;
            let feedback = '';
            
            quiz.questions.forEach((q, index) => {
                const isCorrect = userAnswers[index] === q.correct;
                if (isCorrect) correct++;
                
                feedback += `
                    <div class="feedback-item ${isCorrect ? 'correct' : 'incorrect'}">
                        <strong>Question ${index + 1}:</strong> ${q.question}<br>
                        <strong>Your answer:</strong> ${q.options[userAnswers[index]]}<br>
                        ${!isCorrect ? `<strong>Correct answer:</strong> ${q.options[q.correct]}<br>` : ''}
                        <strong>${isCorrect ? '‚úÖ Correct!' : '‚ùå Incorrect'}</strong>
                    </div>
                `;
            });
            
            const percentage = Math.round((correct / quiz.questions.length) * 100);
            const passed = percentage >= 70;
            
            document.getElementById('score-display').textContent = `${percentage}%`;
            document.getElementById('score-message').innerHTML = `
                You got <strong>${correct}</strong> out of <strong>${quiz.questions.length}</strong> correct!<br>
                <span class="${passed ? 'pass' : 'fail'}">${passed ? 'üéâ You Passed!' : 'üìö Keep Learning!'}</span>
            `;
            document.getElementById('feedback-container').innerHTML = feedback;
            
            document.getElementById('quiz-section').classList.remove('active');
            document.getElementById('results-section').classList.add('active');
            
            if (passed && !completedQuizzes.includes(currentModule)) {
                saveQuizCompletion();
            }
        };

        // Save quiz completion
        async function saveQuizCompletion() {
            completedQuizzes.push(currentModule);
            
            try {
                await db.collection('users')
                    .doc(currentUser.uid)
                    .collection('progress')
                    .doc('quizzes')
                    .set({
                        completed: completedQuizzes,
                        lastUpdated: new Date()
                    });
            } catch (error) {
                console.error('Error saving quiz progress:', error);
            }
        }

        // Back to modules
        window.backToModules = function() {
            document.getElementById('quiz-section').classList.remove('active');
            document.getElementById('results-section').classList.remove('active');
            document.getElementById('module-selector').style.display = 'block';
            renderModuleButtons();
        };

        // Retake quiz
        window.retakeQuiz = function() {
            document.getElementById('results-section').classList.remove('active');
            startQuiz(currentModule);
        };
    </script>
</body>
</html>
